{% extends 'base.html' %}

{% block head %}
	{{ block.super }}
    <link rel="stylesheet" type="text/css" href="/static_media/css/3-column-layout.css" />
    <script type="text/javascript">
    var presets = ['loudness', 'brightness'];
    $(document).ready(function(){
    	apiKey = settings.apiKey;
    	if(apiKey == "")
    	{
    		alert("no KEY!"); 
    	}			
    	else 
    	{				
    		/*======= freesound object ========*/
    		//creating freesound object	
    		freesound = new Freesound(apiKey, true);
    	}
    	var battleObj = {{battle_json|safe}};
    	populate(battleObj); 
    });
    function fight() {
        // TODO: implement preset
        console.log($("#sound_p1").val());
		var url = "/wars/compute/{{p1_sound}}/{{p2_sound}}/loudness/"; 
		$.get(url, function(data) {
			$("#result").append(data);
		});
    }
	function populate(battle) {
		// ---------- populate player1
		var temp = battle['player1_sounds'].split(",");
		for (i in temp) {
			$("#sound_p1").append("<div id='" + temp[i] + "'>" + temp[i] + "</div>");
		}
		// ---------- populate presets
		for (i in presets) {
			$("#presets").append("<div id='" + presets[i] + "'>" + presets[i] + "</div>");
		}
		// ---------- populate player2
		temp = battle['player2_sounds'].split(",");
		for (i in temp) {
			$("#sound_p2").append("<div id='" + temp[i] + "'>" + temp[i] + "</div>");
		}
	}
	</script>
{% endblock %}

{% block content %}

<div id="result"></div>
<div id="current_battle"></div>
<div id="maincontainer">
	<div id="leftcolumn" class="battlecolumn">
		<label for="sound_p1">Player 1</label>
		<div id="sound_p1">sound 1</div>
	</div>
	<div id="contentcolumn" class="battlecolumn">
		<label for="content">Presets</label>
		<div id="presets">presets</div>
	</div>
	<div id="rightcolumn" class="battlecolumn">
		<label for="sound_p2">Player 2</label>
		<div id="sound_p2">sound 2</div>
	</div>
	<br style="clear: both;" />
</div>
<br /><br /><br /><a href="#" onclick="fight()">Fight!</a>

{% endblock %}


